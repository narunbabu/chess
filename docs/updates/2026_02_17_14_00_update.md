# Video Replay Export + Enhanced GIF Share

**Date**: 2026-02-17
**Type**: Feature

## Context
The GIF replay feature used flat Unicode chess pieces and only opened WhatsApp for sharing. Users wanted higher quality video replays shareable to Instagram, Facebook, and WhatsApp, plus a social share menu on desktop.

## Changes

### Video Replay Generation (New)
- **`videoExportUtils.js`** (NEW): Full video generation engine using MediaRecorder API + canvas
  - Renders the existing 3D SVG pieces from `pieces3d.js` onto canvas via `renderToStaticMarkup`
  - Portrait (720x1280, 9:16) for Instagram/TikTok or Landscape (1280x720, 16:9) for YouTube/Desktop
  - Layout: Chess99 header with gold branding, player bars with active turn indicators, full board with move highlights, commentary section with large SAN notation + move annotations + progress bar
  - Opening detection (~29 common openings matched by move sequence)
  - Move annotations: captures, checks, checkmate, castling, promotions
  - Result screen with colored background (green/gold/purple for win/draw/loss)
  - Auto-timing: 12-35s target based on game length, 200-1200ms per move
  - Flash highlight effect on new moves (3 frames)

### Enhanced GIF Share Flow
- GIF button now uses native Web Share API on mobile (shows OS share sheet with all apps)
- Desktop fallback: share menu popup with WhatsApp, Facebook, Instagram, Download options
- Share messages now include chess99.com link for promotion

### Video Integration
- Purple "ðŸ“¹ Vid" icon button in game end card (same style as GIF/Share buttons)
- Format picker modal with Portrait (9:16) and Landscape (16:9) options
- Progress percentage shown during generation
- Available in both single-player and multiplayer game end screens
- Only shown when browser supports MediaRecorder + captureStream

## New Files
- `chess-frontend/src/utils/videoExportUtils.js`

## Modified Files
- `chess-frontend/src/utils/shareUtils.js` â€” Added `shareGameVideo()`, enhanced `shareGameReplay()` with native share
- `chess-frontend/src/components/GameCompletionAnimation.js` â€” Video button, format picker, share menu

## Risks
- MediaRecorder generates video in real-time (15-35s wait for generation)
- WebM format may not play natively on iOS Safari (but shares fine via native share API)
- `react-dom/server` import for SVG rendering adds minor bundle overhead (code-split via dynamic import)
