<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tournament Bracket Visualizer</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            padding: 20px;
            min-height: 100vh;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: white;
            border-radius: 12px;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.2);
            padding: 30px;
        }

        h1 {
            color: #333;
            margin-bottom: 10px;
            font-size: 32px;
        }

        .subtitle {
            color: #666;
            margin-bottom: 30px;
            font-size: 16px;
        }

        .controls {
            display: flex;
            gap: 15px;
            margin-bottom: 30px;
            flex-wrap: wrap;
            align-items: center;
        }

        .config-selector {
            padding: 12px 20px;
            font-size: 16px;
            border: 2px solid #667eea;
            border-radius: 8px;
            background: white;
            cursor: pointer;
            transition: all 0.3s;
        }

        .config-selector:hover {
            background: #667eea;
            color: white;
        }

        .reset-btn, .export-btn {
            padding: 12px 24px;
            font-size: 16px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s;
            font-weight: 600;
        }

        .reset-btn {
            background: #e74c3c;
            color: white;
        }

        .reset-btn:hover {
            background: #c0392b;
        }

        .export-btn {
            background: #2ecc71;
            color: white;
        }

        .export-btn:hover {
            background: #27ae60;
        }

        .stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px;
            border-radius: 8px;
            text-align: center;
        }

        .stat-label {
            font-size: 14px;
            opacity: 0.9;
            margin-bottom: 5px;
        }

        .stat-value {
            font-size: 28px;
            font-weight: bold;
        }

        .rounds-container {
            display: flex;
            gap: 30px;
            overflow-x: auto;
            padding: 20px 0;
        }

        .round {
            min-width: 320px;
            flex-shrink: 0;
        }

        .round.disabled {
            opacity: 0.5;
            pointer-events: none;
        }

        .round-header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 15px;
            border-radius: 8px 8px 0 0;
            font-weight: bold;
            font-size: 18px;
            position: relative;
        }

        .round-type {
            font-size: 12px;
            opacity: 0.9;
            text-transform: uppercase;
            margin-top: 5px;
        }

        .lock-icon {
            position: absolute;
            right: 15px;
            top: 50%;
            transform: translateY(-50%);
            font-size: 20px;
        }

        .matches {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 0 0 8px 8px;
            border: 2px solid #e0e0e0;
            border-top: none;
        }

        .match {
            background: white;
            border-radius: 8px;
            margin-bottom: 12px;
            overflow: hidden;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
            transition: all 0.3s;
        }

        .match:hover {
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
        }

        .match:last-child {
            margin-bottom: 0;
        }

        .match-header {
            background: #3498db;
            color: white;
            padding: 8px 12px;
            font-size: 12px;
            font-weight: bold;
        }

        .player {
            padding: 12px 15px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            cursor: pointer;
            transition: all 0.2s;
            border-bottom: 1px solid #e0e0e0;
        }

        .player:last-child {
            border-bottom: none;
        }

        .player:hover {
            background: #f0f7ff;
        }

        .player.winner {
            background: #d4edda;
            border-left: 4px solid #28a745;
        }

        .player.loser {
            opacity: 0.6;
            text-decoration: line-through;
        }

        .player-info {
            display: flex;
            flex-direction: column;
            gap: 4px;
        }

        .player-name {
            font-weight: 600;
            font-size: 15px;
            color: #333;
        }

        .player-rating {
            font-size: 12px;
            color: #666;
        }

        .winner-badge {
            background: #28a745;
            color: white;
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: bold;
        }

        .podium {
            margin-top: 40px;
            padding: 30px;
            background: linear-gradient(135deg, #ffd89b 0%, #19547b 100%);
            border-radius: 12px;
            color: white;
        }

        .podium h2 {
            margin-bottom: 20px;
            text-align: center;
            font-size: 28px;
        }

        .podium-places {
            display: flex;
            justify-content: center;
            align-items: flex-end;
            gap: 20px;
            margin-top: 30px;
        }

        .podium-place {
            text-align: center;
            background: rgba(255, 255, 255, 0.2);
            padding: 20px;
            border-radius: 12px;
            backdrop-filter: blur(10px);
        }

        .podium-place.first {
            order: 2;
            transform: scale(1.1);
        }

        .podium-place.second {
            order: 1;
        }

        .podium-place.third {
            order: 3;
        }

        .medal {
            font-size: 48px;
            margin-bottom: 10px;
        }

        .place-name {
            font-size: 14px;
            opacity: 0.9;
            margin-bottom: 10px;
        }

        .place-player {
            font-size: 20px;
            font-weight: bold;
        }

        .loading {
            text-align: center;
            padding: 60px;
            font-size: 20px;
            color: #666;
        }

        .error {
            background: #f8d7da;
            color: #721c24;
            padding: 20px;
            border-radius: 8px;
            margin: 20px 0;
        }

        .bye-match {
            background: #fff3cd;
            border-left: 4px solid #ffc107;
        }

        .bye-match .player {
            cursor: default;
        }

        .bye-match .player:hover {
            background: #fff3cd;
        }

        @keyframes pulse {
            0%, 100% {
                transform: scale(1);
            }
            50% {
                transform: scale(1.05);
            }
        }

        .active-round .round-header {
            animation: pulse 2s infinite;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üèÜ Tournament Bracket Visualizer</h1>
        <p class="subtitle">Interactive tournament bracket testing tool - Click on players to set winners</p>

        <div class="controls">
            <select id="configSelector" class="config-selector">
                <option value="">Select Tournament Configuration...</option>
            </select>
            <button id="resetBtn" class="reset-btn">üîÑ Reset Winners</button>
            <button id="exportBtn" class="export-btn">üíæ Export Results</button>
        </div>

        <div class="stats" id="stats"></div>

        <div id="loading" class="loading">
            Select a tournament configuration to begin...
        </div>

        <div id="error" class="error" style="display: none;"></div>

        <div class="rounds-container" id="roundsContainer" style="display: none;"></div>

        <div class="podium" id="podium" style="display: none;">
            <h2>üèÜ Tournament Results</h2>
            <div class="podium-places" id="podiumPlaces"></div>
        </div>
    </div>

    <script>
        let currentTournament = null;
        let matchResults = {};

        // Load tournament configurations
        async function loadConfigurations() {
            try {
                const response = await fetch('tournament_tests_all.json');
                const data = await response.json();

                const selector = document.getElementById('configSelector');
                data.forEach((config, index) => {
                    const option = document.createElement('option');
                    option.value = index;
                    option.textContent = `${config.config_name} (${config.player_count} players, ${config.rounds.length} rounds)`;
                    selector.appendChild(option);
                });

                selector.addEventListener('change', (e) => {
                    if (e.target.value !== '') {
                        loadTournament(data[e.target.value]);
                    }
                });
            } catch (error) {
                showError('Failed to load tournament configurations: ' + error.message);
            }
        }

        function loadTournament(tournament) {
            currentTournament = tournament;
            matchResults = {};

            document.getElementById('loading').style.display = 'none';
            document.getElementById('error').style.display = 'none';
            document.getElementById('roundsContainer').style.display = 'flex';

            renderStats();
            renderRounds();
            updateRoundActivation();
        }

        function renderStats() {
            const stats = document.getElementById('stats');
            stats.innerHTML = `
                <div class="stat-card">
                    <div class="stat-label">Players</div>
                    <div class="stat-value">${currentTournament.player_count}</div>
                </div>
                <div class="stat-card">
                    <div class="stat-label">Total Rounds</div>
                    <div class="stat-value">${currentTournament.rounds.length}</div>
                </div>
                <div class="stat-card">
                    <div class="stat-label">Total Matches</div>
                    <div class="stat-value">${currentTournament.summary.total_matches}</div>
                </div>
                <div class="stat-card">
                    <div class="stat-label">Matches Completed</div>
                    <div class="stat-value" id="completedCount">0</div>
                </div>
            `;
        }

        function renderRounds() {
            const container = document.getElementById('roundsContainer');
            container.innerHTML = '';

            currentTournament.rounds.forEach((round) => {
                const roundDiv = document.createElement('div');
                roundDiv.className = 'round';
                roundDiv.id = `round-${round.round_number}`;

                const lockIcon = round.round_number === 1 ? '' : '<span class="lock-icon">üîí</span>';

                roundDiv.innerHTML = `
                    <div class="round-header">
                        ${round.name}
                        <div class="round-type">${round.type}</div>
                        ${lockIcon}
                    </div>
                    <div class="matches" id="matches-${round.round_number}">
                        ${renderMatches(round)}
                    </div>
                `;

                container.appendChild(roundDiv);
            });
        }

        function renderMatches(round) {
            return round.matches.map((match, index) => {
                const isBye = !match.player2;
                const matchClass = isBye ? 'match bye-match' : 'match';

                return `
                    <div class="${matchClass}" data-match-id="${match.id}">
                        <div class="match-header">Match ${index + 1}</div>
                        ${renderPlayer(match, match.player1, 'player1', isBye)}
                        ${match.player2 ? renderPlayer(match, match.player2, 'player2', isBye) : '<div class="player bye-match"><span>BYE</span></div>'}
                    </div>
                `;
            }).join('');
        }

        function renderPlayer(match, player, playerKey, isBye) {
            if (!player) return '';

            const matchResult = matchResults[match.id];
            const isWinner = matchResult === player.id;
            const isLoser = matchResult && matchResult !== player.id;

            let classes = 'player';
            if (isWinner) classes += ' winner';
            if (isLoser) classes += ' loser';

            const badge = isWinner ? '<span class="winner-badge">WINNER</span>' : '';

            return `
                <div class="${classes}" data-match-id="${match.id}" data-player-id="${player.id}" onclick="selectWinner(${match.id}, ${player.id}, ${isBye})">
                    <div class="player-info">
                        <div class="player-name">${player.name}</div>
                        <div class="player-rating">Rating: ${player.rating}</div>
                    </div>
                    ${badge}
                </div>
            `;
        }

        function selectWinner(matchId, playerId, isBye) {
            if (isBye) return; // Can't select winner for bye matches

            // Toggle winner selection
            if (matchResults[matchId] === playerId) {
                delete matchResults[matchId];
            } else {
                matchResults[matchId] = playerId;
            }

            renderRounds();
            updateRoundActivation();
            updateCompletedCount();
            checkTournamentCompletion();
        }

        function updateRoundActivation() {
            currentTournament.rounds.forEach((round, index) => {
                const roundDiv = document.getElementById(`round-${round.round_number}`);

                if (index === 0) {
                    // First round always active
                    roundDiv.classList.remove('disabled');
                    roundDiv.classList.add('active-round');
                } else {
                    // Check if previous round is complete
                    const previousRound = currentTournament.rounds[index - 1];
                    const previousRoundComplete = isRoundComplete(previousRound);

                    if (previousRoundComplete) {
                        roundDiv.classList.remove('disabled');

                        // Check if current round is complete
                        const currentRoundComplete = isRoundComplete(round);
                        if (!currentRoundComplete) {
                            roundDiv.classList.add('active-round');
                        } else {
                            roundDiv.classList.remove('active-round');
                        }

                        // Update lock icon
                        const lockIcon = roundDiv.querySelector('.lock-icon');
                        if (lockIcon) {
                            lockIcon.textContent = 'üîì';
                        }
                    } else {
                        roundDiv.classList.add('disabled');
                        roundDiv.classList.remove('active-round');
                    }
                }
            });
        }

        function isRoundComplete(round) {
            return round.matches.every(match => {
                // Bye matches are automatically complete
                if (!match.player2) return true;
                // Check if winner is selected
                return matchResults[match.id] !== undefined;
            });
        }

        function updateCompletedCount() {
            const completedMatches = Object.keys(matchResults).length;
            const byeMatches = currentTournament.rounds.reduce((count, round) => {
                return count + round.matches.filter(m => !m.player2).length;
            }, 0);

            document.getElementById('completedCount').textContent = completedMatches + byeMatches;
        }

        function checkTournamentCompletion() {
            const allRoundsComplete = currentTournament.rounds.every(isRoundComplete);

            if (allRoundsComplete) {
                displayPodium();
            } else {
                document.getElementById('podium').style.display = 'none';
            }
        }

        function displayPodium() {
            const podium = document.getElementById('podium');
            const podiumPlaces = document.getElementById('podiumPlaces');

            // Find winner, runner-up, and third place
            const finalRound = currentTournament.rounds[currentTournament.rounds.length - 1];
            const finalMatch = finalRound.matches[0];

            const winnerId = matchResults[finalMatch.id];
            const runnerUpId = winnerId === finalMatch.player1.id ? finalMatch.player2.id : finalMatch.player1.id;

            // Find third place (loser of semi-final who didn't make it to final)
            let thirdPlaceId = null;
            if (currentTournament.rounds.length >= 2) {
                const semiRound = currentTournament.rounds[currentTournament.rounds.length - 2];
                if (semiRound.type === 'semi_final') {
                    semiRound.matches.forEach(match => {
                        const loser = matchResults[match.id] === match.player1.id ? match.player2.id : match.player1.id;
                        if (loser !== runnerUpId) {
                            thirdPlaceId = loser;
                        }
                    });
                }
            }

            const winner = currentTournament.participants.find(p => p.id === winnerId);
            const runnerUp = currentTournament.participants.find(p => p.id === runnerUpId);
            const thirdPlace = thirdPlaceId ? currentTournament.participants.find(p => p.id === thirdPlaceId) : null;

            podiumPlaces.innerHTML = `
                <div class="podium-place first">
                    <div class="medal">ü•á</div>
                    <div class="place-name">Champion</div>
                    <div class="place-player">${winner.name}</div>
                </div>
                <div class="podium-place second">
                    <div class="medal">ü•à</div>
                    <div class="place-name">Runner-up</div>
                    <div class="place-player">${runnerUp.name}</div>
                </div>
                ${thirdPlace ? `
                    <div class="podium-place third">
                        <div class="medal">ü•â</div>
                        <div class="place-name">Third Place</div>
                        <div class="place-player">${thirdPlace.name}</div>
                    </div>
                ` : ''}
            `;

            podium.style.display = 'block';
        }

        function resetWinners() {
            if (confirm('Reset all winner selections?')) {
                matchResults = {};
                renderRounds();
                updateRoundActivation();
                updateCompletedCount();
                document.getElementById('podium').style.display = 'none';
            }
        }

        function exportResults() {
            const results = {
                tournament: currentTournament.config_name,
                player_count: currentTournament.player_count,
                match_results: matchResults,
                rounds: currentTournament.rounds.map(round => ({
                    round_number: round.round_number,
                    name: round.name,
                    type: round.type,
                    complete: isRoundComplete(round)
                }))
            };

            const blob = new Blob([JSON.stringify(results, null, 2)], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `tournament_results_${currentTournament.player_count}_players.json`;
            a.click();
            URL.revokeObjectURL(url);
        }

        function showError(message) {
            const errorDiv = document.getElementById('error');
            errorDiv.textContent = message;
            errorDiv.style.display = 'block';
            document.getElementById('loading').style.display = 'none';
        }

        // Event listeners
        document.getElementById('resetBtn').addEventListener('click', resetWinners);
        document.getElementById('exportBtn').addEventListener('click', exportResults);

        // Initialize
        loadConfigurations();
    </script>
</body>
</html>
